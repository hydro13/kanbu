generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Workspace {
  id                  Int                   @id @default(autoincrement())
  name                String                @db.VarChar(255)
  slug                String                @unique @db.VarChar(100)
  description         String?
  settings            Json                  @default("{}")
  isActive            Boolean               @default(true) @map("is_active")
  createdAt           DateTime              @default(now()) @map("created_at")
  updatedAt           DateTime              @updatedAt @map("updated_at")
  createdById         Int?                  @map("created_by")
  logoUrl             String?               @map("logo_url") @db.VarChar(500)
  apiKeys             ApiKey[]
  auditLogs           AuditLog[]
  githubInstallations GitHubInstallation[]
  githubUserMappings  GitHubUserMapping[]
  groups              Group[]
  projectGroups       ProjectGroup[]
  projects            Project[]
  roleAssignments     RoleAssignment[]
  invitations         WorkspaceInvitation[]
  logo                WorkspaceLogo?
  createdBy           User?                 @relation("WorkspaceCreator", fields: [createdById], references: [id])

  @@map("workspaces")
}

model WorkspaceLogo {
  id          Int       @id @default(autoincrement())
  workspaceId Int       @unique @map("workspace_id")
  data        Bytes
  mimeType    String    @map("mime_type") @db.VarChar(50)
  size        Int
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@map("workspace_logos")
}

model WorkspaceInvitation {
  id          Int           @id @default(autoincrement())
  workspaceId Int           @map("workspace_id")
  email       String        @db.VarChar(255)
  role        WorkspaceRole @default(MEMBER)
  token       String        @unique @db.VarChar(64)
  expiresAt   DateTime      @map("expires_at")
  createdAt   DateTime      @default(now()) @map("created_at")
  createdBy   Int           @map("created_by")
  creator     User          @relation(fields: [createdBy], references: [id])
  workspace   Workspace     @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@map("workspace_invitations")
}

model User {
  id                   Int                       @id @default(autoincrement())
  email                String                    @unique @db.VarChar(255)
  username             String                    @unique @db.VarChar(100)
  name                 String                    @db.VarChar(255)
  passwordHash         String?                   @map("password_hash") @db.VarChar(255)
  avatarUrl            String?                   @map("avatar_url") @db.VarChar(500)
  timezone             String                    @default("Europe/Amsterdam") @db.VarChar(50)
  language             String                    @default("nl") @db.VarChar(10)
  settings             Json                      @default("{}")
  isActive             Boolean                   @default(true) @map("is_active")
  emailVerified        Boolean                   @default(false) @map("email_verified")
  lastLoginAt          DateTime?                 @map("last_login_at")
  createdAt            DateTime                  @default(now()) @map("created_at")
  updatedAt            DateTime                  @updatedAt @map("updated_at")
  defaultFilter        String?                   @map("default_filter")
  failedLoginCount     Int                       @default(0) @map("failed_login_count")
  githubId             String?                   @map("github_id") @db.VarChar(30)
  gitlabId             Int?                      @map("gitlab_id")
  googleId             String?                   @map("google_id") @db.VarChar(255)
  hourlyRate           Decimal?                  @map("hourly_rate") @db.Decimal(10, 2)
  lockedUntil          DateTime?                 @map("locked_until")
  notificationFilter   Int                       @default(4) @map("notification_filter")
  notificationsEnabled Boolean                   @default(true) @map("notifications_enabled")
  publicToken          String?                   @unique @map("public_token") @db.VarChar(64)
  theme                String                    @default("system") @db.VarChar(20)
  twofactorActivated   Boolean                   @default(false) @map("twofactor_activated")
  twofactorSecret      String?                   @map("twofactor_secret") @db.Char(16)
  role                 AppRole                   @default(USER)
  lockoutCount         Int                       @default(0) @map("lockout_count")
  aclEntriesCreated    AclEntry[]                @relation("AclCreator")
  activities           Activity[]
  apiKeys              ApiKey[]
  assistantBindings    AssistantBinding[]
  assistantSetupCodes  AssistantSetupCode[]
  attachments          Attachment[]
  auditLogs            AuditLog[]                @relation("AuditLogActor")
  comments             Comment[]
  githubUserMappings   GitHubUserMapping[]
  groupMembersAdded    GroupMember[]             @relation("GroupMemberAddedBy")
  groupMemberships     GroupMember[]
  invitesSent          Invite[]                  @relation("UserInvites")
  lastLogins           LastLogin[]
  notifications        Notification[]
  passwordResets       PasswordReset[]
  rememberTokens       RememberToken[]
  sessions             Session[]
  subtasksAssigned     Subtask[]
  tasksAssigned        TaskAssignee[]
  tasksCreated         Task[]                    @relation("TaskCreator")
  avatar               UserAvatar?
  metadata             UserMetadata[]
  notificationSettings UserNotificationSetting[]
  pagePreferences      UserPagePreference[]
  invitationsCreated   WorkspaceInvitation[]
  workspacesCreated    Workspace[]               @relation("WorkspaceCreator")

  @@map("users")
}

model Session {
  id        String   @id @db.VarChar(64)
  userId    Int      @map("user_id")
  data      Json     @default("{}")
  ipAddress String?  @map("ip_address") @db.VarChar(45)
  userAgent String?  @map("user_agent")
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model RememberToken {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  token     String   @unique @db.VarChar(64)
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("remember_tokens")
}

model Invite {
  id          Int       @id @default(autoincrement())
  email       String    @db.VarChar(255)
  token       String    @unique @db.VarChar(64)
  role        AppRole   @default(USER)
  invitedById Int       @map("invited_by")
  expiresAt   DateTime  @map("expires_at")
  acceptedAt  DateTime? @map("accepted_at")
  createdAt   DateTime  @default(now()) @map("created_at")
  invitedBy   User      @relation("UserInvites", fields: [invitedById], references: [id])

  @@map("invites")
}

model SystemSetting {
  key       String   @id @db.VarChar(100)
  value     String?
  changedBy Int?     @map("changed_by")
  changedAt DateTime @default(now()) @updatedAt @map("changed_at")

  @@map("system_settings")
}

model Project {
  id               Int                  @id @default(autoincrement())
  workspaceId      Int                  @map("workspace_id")
  name             String               @db.VarChar(255)
  identifier       String?              @db.VarChar(10)
  description      String?
  startDate        DateTime?            @map("start_date") @db.Date
  endDate          DateTime?            @map("end_date") @db.Date
  isActive         Boolean              @default(true) @map("is_active")
  isPublic         Boolean              @default(false) @map("is_public")
  settings         Json                 @default("{}")
  lastActivityAt   DateTime?            @map("last_activity_at")
  createdAt        DateTime             @default(now()) @map("created_at")
  updatedAt        DateTime             @updatedAt @map("updated_at")
  activities       Activity[]
  apiKeys          ApiKey[]
  budgets          Budget[]
  categories       Category[]
  columns          Column[]
  customFields     CustomField[]
  features         Feature[]
  githubRepositories GitHubRepository[]
  groups           Group[]
  milestones       Milestone[]
  modules          Module[]
  projectGroups    ProjectGroupMember[]
  workspace        Workspace            @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  roleAssignments  RoleAssignment[]
  sprints          Sprint[]
  swimlanes        Swimlane[]
  tags             Tag[]
  tasks            Task[]
  webhooks         Webhook[]
  wikiPages        WikiPage[]

  @@unique([workspaceId, identifier])
  @@map("projects")
}

model Feature {
  id          Int      @id @default(autoincrement())
  projectId   Int?     @map("project_id")
  slug        String   @db.VarChar(50)
  name        String   @db.VarChar(100)
  description String?
  icon        String?  @db.VarChar(50)
  sortOrder   Int      @default(0) @map("sort_order")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  scope       String   @db.VarChar(20)
  project     Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([scope, projectId, slug])
  @@index([scope])
  @@map("features")
}

model Column {
  id          Int      @id @default(autoincrement())
  projectId   Int      @map("project_id")
  title       String   @db.VarChar(255)
  description String?
  position    Int      @default(0)
  taskLimit   Int      @default(0) @map("task_limit")
  isCollapsed Boolean  @default(false) @map("is_collapsed")
  showClosed  Boolean  @default(false) @map("show_closed")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tasks       Task[]

  @@map("columns")
}

model Swimlane {
  id          Int      @id @default(autoincrement())
  projectId   Int      @map("project_id")
  name        String   @db.VarChar(255)
  description String?
  position    Int      @default(0)
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tasks       Task[]

  @@map("swimlanes")
}

model Task {
  id                 Int                 @id @default(autoincrement())
  projectId          Int                 @map("project_id")
  columnId           Int                 @map("column_id")
  swimlaneId         Int?                @map("swimlane_id")
  creatorId          Int                 @map("creator_id")
  title              String              @db.VarChar(500)
  description        String?
  reference          String?             @db.VarChar(50)
  priority           Int                 @default(0)
  score              Int                 @default(0)
  progress           Int                 @default(0)
  position           Int                 @default(0)
  color              String?             @db.VarChar(20)
  dateStarted        DateTime?           @map("date_started")
  dateDue            DateTime?           @map("date_due")
  dateCompleted      DateTime?           @map("date_completed")
  timeEstimated      Float               @default(0) @map("time_estimated")
  timeSpent          Float               @default(0) @map("time_spent")
  isActive           Boolean             @default(true) @map("is_active")
  isDraggable        Boolean             @default(true) @map("is_draggable")
  recurrenceData     Json?               @map("recurrence_data")
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  milestoneId        Int?                @map("milestone_id")
  moduleId           Int?                @map("module_id")
  sprintId           Int?                @map("sprint_id")
  categoryId         Int?                @map("category_id")
  reminderAt         DateTime?           @map("reminder_at")
  githubBranch       String?             @map("github_branch") @db.VarChar(255)
  attachments        Attachment[]
  comments           Comment[]
  githubCommits      GitHubCommit[]
  githubIssue        GitHubIssue?
  githubPullRequests GitHubPullRequest[]
  githubWorkflowRuns GitHubWorkflowRun[]
  subtasks           Subtask[]
  assignees          TaskAssignee[]
  customValues       TaskCustomValue[]
  linksTo            TaskLink[]          @relation("TaskLinkTo")
  linksFrom          TaskLink[]          @relation("TaskLinkFrom")
  genxSessions       TaskSession[]
  tags               TaskTag[]
  category           Category?           @relation(fields: [categoryId], references: [id])
  column             Column              @relation(fields: [columnId], references: [id])
  creator            User                @relation("TaskCreator", fields: [creatorId], references: [id])
  milestone          Milestone?          @relation(fields: [milestoneId], references: [id])
  module             Module?             @relation(fields: [moduleId], references: [id])
  project            Project             @relation(fields: [projectId], references: [id], onDelete: Cascade)
  sprint             Sprint?             @relation(fields: [sprintId], references: [id])
  swimlane           Swimlane?           @relation(fields: [swimlaneId], references: [id])

  @@index([projectId, isActive])
  @@index([columnId])
  @@index([dateDue])
  @@map("tasks")
}

model TaskAssignee {
  id        Int      @id @default(autoincrement())
  taskId    Int      @map("task_id")
  userId    Int      @map("user_id")
  createdAt DateTime @default(now()) @map("created_at")
  task      Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([taskId, userId])
  @@map("task_assignees")
}

model Subtask {
  id            Int           @id @default(autoincrement())
  taskId        Int           @map("task_id")
  title         String        @db.VarChar(500)
  status        SubtaskStatus @default(TODO)
  position      Int           @default(0)
  assigneeId    Int?          @map("assignee_id")
  timeEstimated Float         @default(0) @map("time_estimated")
  timeSpent     Float         @default(0) @map("time_spent")
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")
  description   String?
  assignee      User?         @relation(fields: [assigneeId], references: [id])
  task          Task          @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@map("subtasks")
}

model Comment {
  id                Int      @id @default(autoincrement())
  taskId            Int      @map("task_id")
  userId            Int      @map("user_id")
  content           String
  githubCommentId   BigInt?  @unique @map("github_comment_id")
  githubAuthorLogin String?  @db.VarChar(255) @map("github_author_login")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  task              Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user              User     @relation(fields: [userId], references: [id])

  @@index([githubCommentId])
  @@map("comments")
}

model Tag {
  id        Int       @id @default(autoincrement())
  projectId Int       @map("project_id")
  name      String    @db.VarChar(100)
  color     String    @default("grey") @db.VarChar(20)
  createdAt DateTime  @default(now()) @map("created_at")
  project   Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tasks     TaskTag[]

  @@unique([projectId, name])
  @@map("tags")
}

model TaskTag {
  id        Int      @id @default(autoincrement())
  taskId    Int      @map("task_id")
  tagId     Int      @map("tag_id")
  createdAt DateTime @default(now()) @map("created_at")
  tag       Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade)
  task      Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([taskId, tagId])
  @@map("task_tags")
}

model Category {
  id          Int      @id @default(autoincrement())
  projectId   Int      @map("project_id")
  name        String   @db.VarChar(255)
  description String?
  color       String   @default("blue") @db.VarChar(20)
  createdAt   DateTime @default(now()) @map("created_at")
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tasks       Task[]

  @@unique([projectId, name])
  @@map("categories")
}

model Attachment {
  id        Int      @id @default(autoincrement())
  taskId    Int      @map("task_id")
  userId    Int      @map("user_id")
  name      String   @db.VarChar(255)
  path      String   @db.VarChar(500)
  mimeType  String?  @map("mime_type") @db.VarChar(100)
  size      Int      @default(0)
  isImage   Boolean  @default(false) @map("is_image")
  createdAt DateTime @default(now()) @map("created_at")
  task      Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id])

  @@map("attachments")
}

model TaskLink {
  id             Int          @id @default(autoincrement())
  taskId         Int          @map("task_id")
  oppositeTaskId Int          @map("opposite_task_id")
  linkType       TaskLinkType @default(RELATES_TO) @map("link_type")
  createdAt      DateTime     @default(now()) @map("created_at")
  oppositeTask   Task         @relation("TaskLinkTo", fields: [oppositeTaskId], references: [id], onDelete: Cascade)
  task           Task         @relation("TaskLinkFrom", fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([taskId, oppositeTaskId, linkType])
  @@map("task_links")
}

model CustomField {
  id         Int               @id @default(autoincrement())
  projectId  Int               @map("project_id")
  name       String            @db.VarChar(255)
  type       CustomFieldType   @default(TEXT)
  options    Json?
  isRequired Boolean           @default(false) @map("is_required")
  position   Int               @default(0)
  createdAt  DateTime          @default(now()) @map("created_at")
  project    Project           @relation(fields: [projectId], references: [id], onDelete: Cascade)
  values     TaskCustomValue[]

  @@unique([projectId, name])
  @@map("custom_fields")
}

model TaskCustomValue {
  id            Int         @id @default(autoincrement())
  taskId        Int         @map("task_id")
  customFieldId Int         @map("custom_field_id")
  value         String
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")
  customField   CustomField @relation(fields: [customFieldId], references: [id], onDelete: Cascade)
  task          Task        @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([taskId, customFieldId])
  @@map("task_custom_values")
}

model Sprint {
  id          Int          @id @default(autoincrement())
  projectId   Int          @map("project_id")
  name        String       @db.VarChar(255)
  description String?
  status      SprintStatus @default(PLANNING)
  dateStart   DateTime     @map("date_start") @db.Date
  dateEnd     DateTime     @map("date_end") @db.Date
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  project     Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tasks       Task[]

  @@map("sprints")
}

model Module {
  id          Int      @id @default(autoincrement())
  projectId   Int      @map("project_id")
  name        String   @db.VarChar(255)
  description String?
  color       String   @default("blue") @db.VarChar(20)
  position    Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tasks       Task[]

  @@unique([projectId, name])
  @@map("modules")
}

model Milestone {
  id          Int       @id @default(autoincrement())
  projectId   Int       @map("project_id")
  name        String    @db.VarChar(255)
  description String?
  dateDue     DateTime? @map("date_due") @db.Date
  isCompleted Boolean   @default(false) @map("is_completed")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tasks       Task[]

  @@map("milestones")
}

model StickyNote {
  id         Int              @id @default(autoincrement())
  userId     Int              @map("user_id")
  title      String?          @db.VarChar(255)
  content    String
  color      StickyNoteColor  @default(YELLOW)
  isPinned   Boolean          @default(false) @map("is_pinned")
  visibility StickyVisibility @default(PRIVATE)
  createdAt  DateTime         @default(now()) @map("created_at")
  updatedAt  DateTime         @updatedAt @map("updated_at")
  links      StickyNoteLink[]

  @@map("sticky_notes")
}

model StickyNoteLink {
  id           Int            @id @default(autoincrement())
  stickyNoteId Int            @map("sticky_note_id")
  entityType   StickyLinkType @map("entity_type")
  entityId     Int            @map("entity_id")
  createdAt    DateTime       @default(now()) @map("created_at")
  stickyNote   StickyNote     @relation(fields: [stickyNoteId], references: [id], onDelete: Cascade)

  @@unique([stickyNoteId, entityType, entityId])
  @@map("sticky_note_links")
}

model ProjectGroup {
  id          Int                  @id @default(autoincrement())
  workspaceId Int                  @map("workspace_id")
  name        String               @db.VarChar(255)
  description String?
  color       String               @default("blue") @db.VarChar(20)
  status      ProjectGroupStatus   @default(DRAFT)
  createdAt   DateTime             @default(now()) @map("created_at")
  updatedAt   DateTime             @updatedAt @map("updated_at")
  projects    ProjectGroupMember[]
  workspace   Workspace            @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@map("project_groups")
}

model ProjectGroupMember {
  id             Int          @id @default(autoincrement())
  projectGroupId Int          @map("project_group_id")
  projectId      Int          @map("project_id")
  position       Int          @default(0)
  createdAt      DateTime     @default(now()) @map("created_at")
  projectGroup   ProjectGroup @relation(fields: [projectGroupId], references: [id], onDelete: Cascade)
  project        Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectGroupId, projectId])
  @@map("project_group_members")
}

model TaskSession {
  id        Int             @id @default(autoincrement())
  taskId    Int             @map("task_id")
  sessionId String          @map("session_id") @db.VarChar(36)
  linkType  TaskSessionType @default(WORKED_ON) @map("link_type")
  notes     String?
  createdAt DateTime        @default(now()) @map("created_at")
  task      Task            @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([taskId, sessionId, linkType])
  @@index([sessionId])
  @@map("task_sessions")
}

model Budget {
  id        Int          @id @default(autoincrement())
  projectId Int          @map("project_id")
  name      String       @db.VarChar(255)
  amount    Decimal      @db.Decimal(15, 2)
  currency  String       @default("EUR") @db.VarChar(3)
  createdAt DateTime     @default(now()) @map("created_at")
  updatedAt DateTime     @updatedAt @map("updated_at")
  lines     BudgetLine[]
  project   Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("budgets")
}

model BudgetLine {
  id          Int            @id @default(autoincrement())
  budgetId    Int            @map("budget_id")
  description String         @db.VarChar(500)
  amount      Decimal        @db.Decimal(15, 2)
  lineType    BudgetLineType @default(EXPENSE) @map("line_type")
  taskId      Int?           @map("task_id")
  createdAt   DateTime       @default(now()) @map("created_at")
  budget      Budget         @relation(fields: [budgetId], references: [id], onDelete: Cascade)

  @@map("budget_lines")
}

model WikiPage {
  id         Int      @id @default(autoincrement())
  projectId  Int      @map("project_id")
  title      String   @db.VarChar(255)
  content    String
  creatorId  Int?     @map("creator_id")
  modifierId Int?     @map("modifier_id")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("wiki_pages")
}

model ApiKey {
  id                 Int         @id @default(autoincrement())
  userId             Int         @map("user_id")
  name               String      @db.VarChar(255)
  keyPrefix          String      @map("key_prefix") @db.VarChar(8)
  keyHash            String      @map("key_hash") @db.VarChar(255)
  permissions        Json        @default("[]")
  rateLimit          Int         @default(100) @map("rate_limit")
  lastUsedAt         DateTime?   @map("last_used_at")
  expiresAt          DateTime?   @map("expires_at")
  isActive           Boolean     @default(true) @map("is_active")
  createdAt          DateTime    @default(now()) @map("created_at")
  updatedAt          DateTime    @updatedAt @map("updated_at")
  isServiceAccount   Boolean     @default(false) @map("is_service_account")
  projectId          Int?        @map("project_id")
  scope              ApiKeyScope @default(USER)
  serviceAccountName String?     @map("service_account_name") @db.VarChar(100)
  workspaceId        Int?        @map("workspace_id")
  project            Project?    @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user               User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  workspace          Workspace?  @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([keyPrefix])
  @@index([workspaceId])
  @@index([projectId])
  @@map("api_keys")
}

model Webhook {
  id           Int               @id @default(autoincrement())
  projectId    Int               @map("project_id")
  name         String            @db.VarChar(255)
  url          String            @db.VarChar(500)
  secret       String            @db.VarChar(64)
  events       Json              @default("[]")
  isActive     Boolean           @default(true) @map("is_active")
  lastSuccess  DateTime?         @map("last_success")
  lastFailure  DateTime?         @map("last_failure")
  failureCount Int               @default(0) @map("failure_count")
  createdAt    DateTime          @default(now()) @map("created_at")
  updatedAt    DateTime          @updatedAt @map("updated_at")
  deliveries   WebhookDelivery[]
  project      Project           @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("webhooks")
}

model WebhookDelivery {
  id          Int      @id @default(autoincrement())
  webhookId   Int      @map("webhook_id")
  event       String   @db.VarChar(100)
  payload     Json
  statusCode  Int?     @map("status_code")
  response    String?
  duration    Int?
  success     Boolean  @default(false)
  attempts    Int      @default(1)
  deliveredAt DateTime @default(now()) @map("delivered_at")
  webhook     Webhook  @relation(fields: [webhookId], references: [id], onDelete: Cascade)

  @@index([webhookId, deliveredAt])
  @@map("webhook_deliveries")
}

model Notification {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  type      String   @db.VarChar(100)
  title     String   @db.VarChar(255)
  content   String?
  data      Json     @default("{}")
  isRead    Boolean  @default(false) @map("is_read")
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isRead])
  @@map("notifications")
}

model Activity {
  id         Int      @id @default(autoincrement())
  projectId  Int      @map("project_id")
  userId     Int?     @map("user_id")
  eventType  String   @db.VarChar(100)
  entityType String   @db.VarChar(50)
  entityId   Int      @map("entity_id")
  changes    Json     @default("{}")
  createdAt  DateTime @default(now()) @map("created_at")
  project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user       User?    @relation(fields: [userId], references: [id])

  @@index([projectId, createdAt])
  @@map("activities")
}

model PasswordReset {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  token     String   @unique @db.VarChar(80)
  expiresAt DateTime @map("expires_at")
  ip        String   @db.VarChar(45)
  userAgent String   @map("user_agent") @db.VarChar(255)
  isUsed    Boolean  @default(false) @map("is_used")
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("password_resets")
}

model LastLogin {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  authType  String   @map("auth_type") @db.VarChar(25)
  ip        String   @db.VarChar(45)
  userAgent String   @map("user_agent") @db.VarChar(255)
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("last_logins")
}

model UserMetadata {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  key       String   @db.VarChar(100)
  value     String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, key])
  @@map("user_metadata")
}

model UserNotificationSetting {
  id               Int     @id @default(autoincrement())
  userId           Int     @map("user_id")
  notificationType String  @map("notification_type") @db.VarChar(50)
  isEnabled        Boolean @default(true) @map("is_enabled")
  user             User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, notificationType])
  @@map("user_notification_settings")
}

model UserAvatar {
  id        Int      @id @default(autoincrement())
  userId    Int      @unique @map("user_id")
  data      Bytes
  mimeType  String   @map("mime_type") @db.VarChar(50)
  size      Int
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_avatars")
}

model UserPagePreference {
  id          Int      @id @default(autoincrement())
  userId      Int      @map("user_id")
  deviceId    String   @map("device_id") @db.VarChar(36)
  pagePath    String   @map("page_path") @db.VarChar(255)
  isFullWidth Boolean  @default(false) @map("is_full_width")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, deviceId, pagePath])
  @@index([userId, deviceId])
  @@map("user_page_preferences")
}

model Group {
  id                Int               @id @default(autoincrement())
  name              String            @unique @db.VarChar(255)
  displayName       String            @map("display_name") @db.VarChar(255)
  description       String?
  type              GroupType
  workspaceId       Int?              @map("workspace_id")
  projectId         Int?              @map("project_id")
  externalId        String?           @unique @map("external_id") @db.VarChar(255)
  source            GroupSource       @default(LOCAL)
  isSystem          Boolean           @default(false) @map("is_system")
  isActive          Boolean           @default(true) @map("is_active")
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")
  distinguishedName String?           @unique @map("distinguished_name") @db.VarChar(500)
  objectGuid        String            @unique @default(uuid()) @map("object_guid") @db.VarChar(36)
  parentGroupId     Int?              @map("parent_group_id")
  scope             GroupScope        @default(DOMAIN_LOCAL)
  isSecurityGroup   Boolean           @default(false) @map("is_security_group")
  members           GroupMember[]
  permissions       GroupPermission[]
  parentGroup       Group?            @relation("GroupHierarchy", fields: [parentGroupId], references: [id])
  childGroups       Group[]           @relation("GroupHierarchy")
  project           Project?          @relation(fields: [projectId], references: [id], onDelete: Cascade)
  workspace         Workspace?        @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  roleAssignments   RoleAssignment[]

  @@index([type])
  @@index([workspaceId])
  @@index([projectId])
  @@index([parentGroupId])
  @@map("groups")
}

model GroupMember {
  id           Int        @id @default(autoincrement())
  groupId      Int        @map("group_id")
  userId       Int        @map("user_id")
  addedAt      DateTime   @default(now()) @map("added_at")
  addedById    Int?       @map("added_by")
  externalSync Boolean    @default(false) @map("external_sync")
  expiresAt    DateTime?  @map("expires_at")
  memberType   MemberType @default(DIRECT) @map("member_type")
  addedBy      User?      @relation("GroupMemberAddedBy", fields: [addedById], references: [id])
  group        Group      @relation(fields: [groupId], references: [id], onDelete: Cascade)
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupId, userId])
  @@index([userId])
  @@index([expiresAt])
  @@map("group_members")
}

model Permission {
  id               Int               @id @default(autoincrement())
  name             String            @unique @db.VarChar(100)
  displayName      String            @map("display_name") @db.VarChar(255)
  description      String?
  category         String            @db.VarChar(50)
  parentId         Int?              @map("parent_id")
  sortOrder        Int               @default(0) @map("sort_order")
  createdAt        DateTime          @default(now()) @map("created_at")
  groupPermissions GroupPermission[]
  parent           Permission?       @relation("PermissionHierarchy", fields: [parentId], references: [id])
  children         Permission[]      @relation("PermissionHierarchy")

  @@index([category])
  @@index([parentId])
  @@map("permissions")
}

model GroupPermission {
  id           Int        @id @default(autoincrement())
  groupId      Int        @map("group_id")
  permissionId Int        @map("permission_id")
  accessType   AccessType @default(ALLOW) @map("access_type")
  workspaceId  Int?       @map("workspace_id")
  projectId    Int?       @map("project_id")
  inherited    Boolean    @default(false)
  createdAt    DateTime   @default(now()) @map("created_at")
  createdById  Int?       @map("created_by")
  group        Group      @relation(fields: [groupId], references: [id], onDelete: Cascade)
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([groupId, permissionId, workspaceId, projectId])
  @@index([groupId])
  @@index([permissionId])
  @@index([workspaceId])
  @@index([projectId])
  @@map("group_permissions")
}

model RoleAssignment {
  id                Int            @id @default(autoincrement())
  groupId           Int            @map("group_id")
  workspaceId       Int?           @map("workspace_id")
  projectId         Int?           @map("project_id")
  role              AssignmentRole @default(MEMBER)
  inheritToChildren Boolean        @default(true) @map("inherit_to_children")
  createdAt         DateTime       @default(now()) @map("created_at")
  createdById       Int?           @map("created_by")
  group             Group          @relation(fields: [groupId], references: [id], onDelete: Cascade)
  project           Project?       @relation(fields: [projectId], references: [id], onDelete: Cascade)
  workspace         Workspace?     @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([groupId, workspaceId, projectId])
  @@index([groupId])
  @@index([workspaceId])
  @@index([projectId])
  @@map("role_assignments")
}

model AclEntry {
  id                Int      @id @default(autoincrement())
  resourceType      String   @map("resource_type") @db.VarChar(50)
  resourceId        Int?     @map("resource_id")
  principalType     String   @map("principal_type") @db.VarChar(10)
  principalId       Int      @map("principal_id")
  permissions       Int      @default(0)
  deny              Boolean  @default(false)
  inherited         Boolean  @default(false)
  inheritToChildren Boolean  @default(true) @map("inherit_to_children")
  createdAt         DateTime @default(now()) @map("created_at")
  createdById       Int?     @map("created_by")
  updatedAt         DateTime @updatedAt @map("updated_at")
  createdBy         User?    @relation("AclCreator", fields: [createdById], references: [id])

  @@unique([resourceType, resourceId, principalType, principalId, deny])
  @@index([resourceType, resourceId])
  @@index([principalType, principalId])
  @@index([inherited])
  @@map("acl_entries")
}

model AuditLog {
  id           Int        @id @default(autoincrement())
  category     String     @db.VarChar(30)
  action       String     @db.VarChar(50)
  resourceType String     @map("resource_type") @db.VarChar(50)
  resourceId   Int?       @map("resource_id")
  resourceName String?    @map("resource_name") @db.VarChar(255)
  targetType   String?    @map("target_type") @db.VarChar(50)
  targetId     Int?       @map("target_id")
  targetName   String?    @map("target_name") @db.VarChar(255)
  changes      Json       @default("{}")
  metadata     Json       @default("{}")
  userId       Int        @map("user_id")
  workspaceId  Int?       @map("workspace_id")
  ipAddress    String?    @map("ip_address") @db.VarChar(45)
  userAgent    String?    @map("user_agent")
  createdAt    DateTime   @default(now()) @map("created_at")
  user         User       @relation("AuditLogActor", fields: [userId], references: [id])
  workspace    Workspace? @relation(fields: [workspaceId], references: [id])

  @@index([category, createdAt])
  @@index([action])
  @@index([resourceType, resourceId])
  @@index([userId, createdAt])
  @@index([workspaceId, createdAt])
  @@index([createdAt])
  @@map("audit_logs")
}

/// Temporary setup code for pairing (5 min TTL, one-time use)
model AssistantSetupCode {
  id         Int       @id @default(autoincrement())
  userId     Int       @map("user_id")
  code       String    @unique @db.VarChar(14)
  createdAt  DateTime  @default(now()) @map("created_at")
  expiresAt  DateTime  @map("expires_at")
  consumedAt DateTime? @map("consumed_at")
  machineId  String?   @map("machine_id") @db.VarChar(64)
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([code])
  @@index([userId])
  @@index([expiresAt])
  @@map("assistant_setup_codes")
}

/// Permanent binding between user and machine (after setup code exchange)
model AssistantBinding {
  id          Int       @id @default(autoincrement())
  userId      Int       @map("user_id")
  machineId   String    @map("machine_id") @db.VarChar(64)
  machineName String?   @map("machine_name") @db.VarChar(100)
  tokenHash   String    @map("token_hash") @db.VarChar(255)
  tokenPrefix String    @map("token_prefix") @db.VarChar(12)
  createdAt   DateTime  @default(now()) @map("created_at")
  lastUsedAt  DateTime? @map("last_used_at")
  revokedAt   DateTime? @map("revoked_at")
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, machineId])
  @@index([tokenPrefix])
  @@index([revokedAt])
  @@map("assistant_bindings")
}

/// GitHub App Installation (org/user level) - Workspace scoped
model GitHubInstallation {
  id             Int                @id @default(autoincrement())
  workspaceId    Int                @map("workspace_id")
  installationId BigInt             @unique @map("installation_id")
  accountType    String             @db.VarChar(20)
  accountId      BigInt             @map("account_id")
  accountLogin   String             @map("account_login") @db.VarChar(255)
  accessToken    String?            @map("access_token")
  tokenExpiresAt DateTime?          @map("token_expires_at")
  permissions    Json               @default("{}")
  events         String[]           @default([])
  suspendedAt    DateTime?          @map("suspended_at")
  createdAt      DateTime           @default(now()) @map("created_at")
  updatedAt      DateTime           @updatedAt @map("updated_at")
  workspace      Workspace          @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  repositories   GitHubRepository[]

  @@index([workspaceId])
  @@index([accountLogin])
  @@map("github_installations")
}

/// User Mapping: GitHub Login â†” Kanbu User (Workspace Level)
model GitHubUserMapping {
  id              Int       @id @default(autoincrement())
  workspaceId     Int       @map("workspace_id")
  userId          Int       @map("user_id")
  githubLogin     String    @map("github_login") @db.VarChar(255)
  githubId        BigInt?   @map("github_id")
  githubEmail     String?   @map("github_email") @db.VarChar(255)
  githubAvatarUrl String?   @map("github_avatar_url") @db.VarChar(512)
  autoMatched     Boolean   @default(false) @map("auto_matched")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  workspace       Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, githubLogin])
  @@unique([workspaceId, userId])
  @@index([githubLogin])
  @@map("github_user_mappings")
}

/// GitHub Repository linked to Kanbu Project (multi-repo support)
model GitHubRepository {
  id             Int                 @id @default(autoincrement())
  projectId      Int                 @map("project_id")
  installationId Int                 @map("installation_id")
  repoId         BigInt              @map("repo_id")
  owner          String              @db.VarChar(255)
  name           String              @db.VarChar(255)
  fullName       String              @map("full_name") @db.VarChar(512)
  defaultBranch  String              @default("main") @map("default_branch") @db.VarChar(255)
  isPrivate      Boolean             @default(false) @map("is_private")
  isPrimary      Boolean             @default(false) @map("is_primary")
  syncEnabled    Boolean             @default(true) @map("sync_enabled")
  syncSettings   Json                @default("{}") @map("sync_settings")
  lastSyncAt     DateTime?           @map("last_sync_at")
  webhookId      BigInt?             @map("webhook_id")
  webhookSecret  String?             @map("webhook_secret") @db.VarChar(255)
  createdAt      DateTime            @default(now()) @map("created_at")
  updatedAt      DateTime            @updatedAt @map("updated_at")
  commits        GitHubCommit[]
  issues         GitHubIssue[]
  milestones     GitHubMilestone[]
  pullRequests   GitHubPullRequest[]
  releases       GitHubRelease[]
  deployments    GitHubDeployment[]
  checkRuns      GitHubCheckRun[]
  installation   GitHubInstallation  @relation(fields: [installationId], references: [id])
  project        Project             @relation(fields: [projectId], references: [id], onDelete: Cascade)
  syncLogs       GitHubSyncLog[]
  workflowRuns   GitHubWorkflowRun[]

  @@unique([projectId, owner, name])
  @@unique([owner, name])
  @@index([installationId])
  @@index([projectId])
  @@map("github_repositories")
}

/// Synced GitHub Issues
model GitHubIssue {
  id            Int              @id @default(autoincrement())
  repositoryId  Int              @map("repository_id")
  taskId        Int?             @unique @map("task_id")
  issueNumber   Int              @map("issue_number")
  issueId       BigInt           @map("issue_id")
  title         String           @db.VarChar(500)
  state         String           @db.VarChar(20)
  syncDirection String           @default("bidirectional") @map("sync_direction") @db.VarChar(20)
  lastSyncAt    DateTime?        @map("last_sync_at")
  syncHash      String?          @map("sync_hash") @db.VarChar(64)
  createdAt     DateTime         @default(now()) @map("created_at")
  updatedAt     DateTime         @updatedAt @map("updated_at")
  repository    GitHubRepository @relation(fields: [repositoryId], references: [id], onDelete: Cascade)
  task          Task?            @relation(fields: [taskId], references: [id], onDelete: SetNull)

  @@unique([repositoryId, issueNumber])
  @@map("github_issues")
}

/// Pull Requests linked to Tasks
model GitHubPullRequest {
  id           Int                 @id @default(autoincrement())
  repositoryId Int                 @map("repository_id")
  taskId       Int?                @map("task_id")
  prNumber     Int                 @map("pr_number")
  prId         BigInt              @map("pr_id")
  title        String              @db.VarChar(500)
  state        String              @db.VarChar(20)
  headBranch   String              @map("head_branch") @db.VarChar(255)
  baseBranch   String              @map("base_branch") @db.VarChar(255)
  authorLogin  String              @map("author_login") @db.VarChar(255)
  mergedAt     DateTime?           @map("merged_at")
  closedAt     DateTime?           @map("closed_at")
  createdAt    DateTime            @default(now()) @map("created_at")
  updatedAt    DateTime            @updatedAt @map("updated_at")
  repository   GitHubRepository    @relation(fields: [repositoryId], references: [id], onDelete: Cascade)
  task         Task?               @relation(fields: [taskId], references: [id], onDelete: SetNull)
  workflowRuns GitHubWorkflowRun[]
  reviews      GitHubReview[]
  checkRuns    GitHubCheckRun[]

  @@unique([repositoryId, prNumber])
  @@index([taskId])
  @@map("github_pull_requests")
}

/// Commits linked to Tasks
model GitHubCommit {
  id           Int              @id @default(autoincrement())
  repositoryId Int              @map("repository_id")
  taskId       Int?             @map("task_id")
  sha          String           @db.VarChar(40)
  message      String
  authorName   String           @map("author_name") @db.VarChar(255)
  authorEmail  String           @map("author_email") @db.VarChar(255)
  authorLogin  String?          @map("author_login") @db.VarChar(255)
  committedAt  DateTime         @map("committed_at")
  createdAt    DateTime         @default(now()) @map("created_at")
  repository   GitHubRepository @relation(fields: [repositoryId], references: [id], onDelete: Cascade)
  task         Task?            @relation(fields: [taskId], references: [id], onDelete: SetNull)

  @@unique([repositoryId, sha])
  @@index([taskId])
  @@map("github_commits")
}

/// Sync Activity Log
model GitHubSyncLog {
  id           Int              @id @default(autoincrement())
  repositoryId Int              @map("repository_id")
  action       String           @db.VarChar(50)
  direction    String           @db.VarChar(20)
  entityType   String           @db.VarChar(20)
  entityId     String?          @map("entity_id") @db.VarChar(50)
  details      Json             @default("{}")
  status       String           @default("success") @db.VarChar(20)
  errorMessage String?          @map("error_message")
  createdAt    DateTime         @default(now()) @map("created_at")
  repository   GitHubRepository @relation(fields: [repositoryId], references: [id], onDelete: Cascade)

  @@index([repositoryId, createdAt])
  @@map("github_sync_logs")
}

/// GitHub Actions Workflow Runs
/// Tracks CI/CD workflow executions for tasks and PRs
model GitHubWorkflowRun {
  id            Int                @id @default(autoincrement())
  repositoryId  Int                @map("repository_id")
  taskId        Int?               @map("task_id")
  pullRequestId Int?               @map("pull_request_id")
  runId         BigInt             @map("run_id")
  workflowId    BigInt             @map("workflow_id")
  workflowName  String             @map("workflow_name") @db.VarChar(255)
  event         String             @db.VarChar(50)
  status        String             @db.VarChar(50)
  conclusion    String?            @db.VarChar(50)
  headSha       String             @map("head_sha") @db.VarChar(40)
  headBranch    String             @map("head_branch") @db.VarChar(255)
  htmlUrl       String             @map("html_url") @db.VarChar(512)
  runNumber     Int                @map("run_number")
  runAttempt    Int                @default(1) @map("run_attempt")
  actor         String?            @db.VarChar(255)
  startedAt     DateTime?          @map("started_at")
  completedAt   DateTime?          @map("completed_at")
  createdAt     DateTime           @default(now()) @map("created_at")
  updatedAt     DateTime           @updatedAt @map("updated_at")
  pullRequest   GitHubPullRequest? @relation(fields: [pullRequestId], references: [id])
  repository    GitHubRepository   @relation(fields: [repositoryId], references: [id], onDelete: Cascade)
  task          Task?              @relation(fields: [taskId], references: [id])

  @@unique([repositoryId, runId])
  @@index([taskId])
  @@index([pullRequestId])
  @@index([status])
  @@index([headBranch])
  @@map("github_workflow_runs")
}

/// GitHub Pull Request Reviews
/// Tracks code review submissions and their state
model GitHubReview {
  id            Int                   @id @default(autoincrement())
  pullRequestId Int                   @map("pull_request_id")
  reviewId      BigInt                @map("review_id")
  authorLogin   String                @map("author_login") @db.VarChar(255)
  state         String                @db.VarChar(50) // 'PENDING' | 'COMMENTED' | 'APPROVED' | 'CHANGES_REQUESTED' | 'DISMISSED'
  body          String?               @db.Text
  htmlUrl       String?               @map("html_url") @db.VarChar(512)
  submittedAt   DateTime?             @map("submitted_at")
  createdAt     DateTime              @default(now()) @map("created_at")
  updatedAt     DateTime              @updatedAt @map("updated_at")
  pullRequest   GitHubPullRequest     @relation(fields: [pullRequestId], references: [id], onDelete: Cascade)
  comments      GitHubReviewComment[]

  @@unique([pullRequestId, reviewId])
  @@index([authorLogin])
  @@index([state])
  @@map("github_reviews")
}

/// GitHub Review Comments
/// Individual comments within a review, linked to specific code locations
model GitHubReviewComment {
  id          Int          @id @default(autoincrement())
  reviewId    Int          @map("review_id")
  commentId   BigInt       @map("comment_id")
  path        String       @db.VarChar(512)
  line        Int?
  side        String?      @db.VarChar(10) // 'LEFT' | 'RIGHT'
  body        String       @db.Text
  authorLogin String       @map("author_login") @db.VarChar(255)
  htmlUrl     String?      @map("html_url") @db.VarChar(512)
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  review      GitHubReview @relation(fields: [reviewId], references: [id], onDelete: Cascade)

  @@unique([reviewId, commentId])
  @@map("github_review_comments")
}

/// GitHub Milestones
/// Synced from GitHub, can be linked to Kanbu milestones
model GitHubMilestone {
  id              Int              @id @default(autoincrement())
  repositoryId    Int              @map("repository_id")
  milestoneNumber Int              @map("milestone_number")
  milestoneId     BigInt           @map("milestone_id")
  title           String           @db.VarChar(255)
  description     String?          @db.Text
  state           String           @db.VarChar(20) // 'open' | 'closed'
  dueOn           DateTime?        @map("due_on")
  closedAt        DateTime?        @map("closed_at")
  openIssues      Int              @default(0) @map("open_issues")
  closedIssues    Int              @default(0) @map("closed_issues")
  htmlUrl         String?          @map("html_url") @db.VarChar(512)
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  repository      GitHubRepository @relation(fields: [repositoryId], references: [id], onDelete: Cascade)

  @@unique([repositoryId, milestoneNumber])
  @@index([state])
  @@map("github_milestones")
}

/// GitHub Releases
/// Track releases and release notes for a repository
model GitHubRelease {
  id              Int              @id @default(autoincrement())
  repositoryId    Int              @map("repository_id")
  releaseId       BigInt           @map("release_id")
  tagName         String           @map("tag_name") @db.VarChar(255)
  name            String?          @db.VarChar(255)
  body            String?          @db.Text
  draft           Boolean          @default(false)
  prerelease      Boolean          @default(false)
  authorLogin     String?          @map("author_login") @db.VarChar(255)
  htmlUrl         String?          @map("html_url") @db.VarChar(512)
  tarballUrl      String?          @map("tarball_url") @db.VarChar(512)
  zipballUrl      String?          @map("zipball_url") @db.VarChar(512)
  publishedAt     DateTime?        @map("published_at")
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  repository      GitHubRepository @relation(fields: [repositoryId], references: [id], onDelete: Cascade)

  @@unique([repositoryId, releaseId])
  @@index([tagName])
  @@index([publishedAt])
  @@map("github_releases")
}

/// GitHub Deployments
/// Tracks deployment events and their status for environments
model GitHubDeployment {
  id           Int              @id @default(autoincrement())
  repositoryId Int              @map("repository_id")
  deploymentId BigInt           @map("deployment_id")
  environment  String           @db.VarChar(255)
  ref          String           @db.VarChar(255)
  sha          String           @db.VarChar(40)
  task         String?          @db.VarChar(255)
  description  String?          @db.Text
  creator      String?          @db.VarChar(255)
  status       String           @db.VarChar(50)
  targetUrl    String?          @map("target_url") @db.VarChar(512)
  createdAt    DateTime         @default(now()) @map("created_at")
  updatedAt    DateTime         @updatedAt @map("updated_at")
  repository   GitHubRepository @relation(fields: [repositoryId], references: [id], onDelete: Cascade)

  @@unique([repositoryId, deploymentId])
  @@index([environment])
  @@index([status])
  @@map("github_deployments")
}

/// GitHub Check Runs
/// Tracks CI check runs and their results
model GitHubCheckRun {
  id            Int                @id @default(autoincrement())
  repositoryId  Int                @map("repository_id")
  pullRequestId Int?               @map("pull_request_id")
  checkRunId    BigInt             @map("check_run_id")
  name          String             @db.VarChar(255)
  headSha       String             @map("head_sha") @db.VarChar(40)
  status        String             @db.VarChar(50)
  conclusion    String?            @db.VarChar(50)
  startedAt     DateTime?          @map("started_at")
  completedAt   DateTime?          @map("completed_at")
  outputTitle   String?            @map("output_title") @db.VarChar(255)
  outputSummary String?            @map("output_summary") @db.Text
  createdAt     DateTime           @default(now()) @map("created_at")
  repository    GitHubRepository   @relation(fields: [repositoryId], references: [id], onDelete: Cascade)
  pullRequest   GitHubPullRequest? @relation(fields: [pullRequestId], references: [id], onDelete: SetNull)

  @@unique([repositoryId, checkRunId])
  @@index([pullRequestId])
  @@index([headSha])
  @@index([status])
  @@map("github_check_runs")
}

enum WorkspaceRole {
  OWNER
  ADMIN
  MEMBER
  VIEWER
}

enum AppRole {
  ADMIN
  MANAGER
  USER
}

enum ProjectRole {
  OWNER
  MANAGER
  MEMBER
  VIEWER
}

enum SubtaskStatus {
  TODO
  IN_PROGRESS
  DONE
}

enum TaskLinkType {
  RELATES_TO
  BLOCKS
  IS_BLOCKED_BY
  DUPLICATES
  IS_DUPLICATED_BY
  IS_CHILD_OF
  IS_PARENT_OF
  FOLLOWS
  IS_FOLLOWED_BY
  FIXES
  IS_FIXED_BY
}

enum CustomFieldType {
  TEXT
  NUMBER
  DATE
  CHECKBOX
  DROPDOWN
  URL
  EMAIL
}

enum SprintStatus {
  PLANNING
  ACTIVE
  COMPLETED
}

enum StickyNoteColor {
  YELLOW
  PINK
  BLUE
  GREEN
  PURPLE
  ORANGE
}

enum StickyVisibility {
  PRIVATE
  PUBLIC
}

enum StickyLinkType {
  PROJECT
  TASK
  SPRINT
  WIKI_PAGE
  PROJECT_GROUP
}

enum ProjectGroupStatus {
  DRAFT
  PLANNED
  ACTIVE
  COMPLETED
  CLOSED
}

enum TaskSessionType {
  WORKED_ON
  CREATED
  REVIEWED
  MENTIONED
}

enum BudgetLineType {
  EXPENSE
  INCOME
}

enum ApiKeyScope {
  USER
  WORKSPACE
  PROJECT
}

enum GroupType {
  SYSTEM
  WORKSPACE
  WORKSPACE_ADMIN
  PROJECT
  PROJECT_ADMIN
  CUSTOM
}

enum GroupScope {
  DOMAIN_LOCAL
  GLOBAL
  UNIVERSAL
}

enum MemberType {
  DIRECT
  NESTED
  DYNAMIC
}

enum AccessType {
  ALLOW
  DENY
}

enum GroupSource {
  LOCAL
  LDAP
  AZURE_AD
  SCIM
}

enum AssignmentRole {
  VIEWER
  MEMBER
  MANAGER
  ADMIN
  OWNER
}
